# This benchamrking suite contains 42 io tests and 29 rpc tests.
# The purpose of this suite is to provide detailed insight into the performance across various configurations

### TESTS

### IO

# The following 20 tests test io_tester for appending, sequential and random reads and writes of size 1kB, 4kB, 256kB and 1024kB - each combination

- type: io
  iterations: 1
  name: io_append_1kb
  config:
  - name: io_append_1kb
    type: append
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1kB
      shares: 10

- type: io
  iterations: 1
  name: io_append_32kb
  config:
  - name: io_append_32kb
    type: append
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 32kB
      shares: 10

- type: io
  iterations: 1
  name: io_append_256kb
  config:
  - name: io_append_256kb
    type: append
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 10

- type: io
  iterations: 1
  name: io_append_1024kb
  config:
  - name: io_append_1024kb
    type: append
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1024kB
      shares: 10

- type: io
  iterations: 1
  name: io_seqread_1kb
  config:
  - name: io_seqread_1kb
    type: seqread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1kB
      shares: 10

- type: io
  iterations: 1
  name: io_seqread_32kb
  config:
  - name: io_seqread_32kb
    type: seqread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 32kB
      shares: 10

- type: io
  iterations: 1
  name: io_seqread_256kb
  config:
  - name: io_seqread_256kb
    type: seqread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 10

- type: io
  iterations: 1
  name: io_seqread_1024kb
  config:
  - name: io_seqread_1024kb
    type: seqread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1024kB
      shares: 10

- type: io
  iterations: 1
  name: io_seqwrite_1kb
  config:
  - name: io_seqwrite_1kb
    type: overwrite
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1kB
      shares: 10

- type: io
  iterations: 1
  name: io_seqwrite_32kb
  config:
  - name: io_seqwrite_32kb
    type: overwrite
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 32kB
      shares: 10

- type: io
  iterations: 1
  name: io_seqwrite_256kb
  config:
  - name: io_seqwrite_256kb
    type: overwrite
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 10

- type: io
  iterations: 1
  name: io_seqwrite_1024kb
  config:
  - name: io_seqwrite_1024kb
    type: overwrite
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1024kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_1kb
  config:
  - name: io_randread_1kb
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_32kb
  config:
  - name: io_randread_32kb
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 32kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_256kb
  config:
  - name: io_randread_256kb
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_1024kb
  config:
  - name: io_randread_1024kb
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1024kB
      shares: 10

- type: io
  iterations: 1
  name: io_randwrite_1kb
  config:
  - name: io_randwrite_1kb
    type: randwrite
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1kB
      shares: 10

- type: io
  iterations: 1
  name: io_randwrite_32kb
  config:
  - name: io_randwrite_32kb
    type: randwrite
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 32kB
      shares: 10

- type: io
  iterations: 1
  name: io_randwrite_256kb
  config:
  - name: io_randwrite_256kb
    type: randwrite
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 10

- type: io
  iterations: 1
  name: io_randwrite_1024kb
  config:
  - name: io_randwrite_1024kb
    type: randwrite
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1024kB
      shares: 10

# The following 4 tests check the impact of allocating more shares to random reads

- type: io
  iterations: 1
  name: io_randread_4kb_shares_100
  config:
  - name: io_randread_4kb_shares_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 4kB
      shares: 100

- type: io
  iterations: 1
  name: io_randread_32kb_shares_100
  config:
  - name: io_randread_32kb_shares_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 32kB
      shares: 100

- type: io
  iterations: 1
  name: io_randread_256kb_shares_100
  config:
  - name: io_randread_256kb_shares_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 100

- type: io
  iterations: 1
  name: io_randread_1024kb_shares_100
  config:
  - name: io_randread_1024kb_shares_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1024kB
      shares: 100

# The following 8 tests check the impact of setting parallelism to either 1 or 20 for random reads, instead of the default 10

- type: io
  iterations: 1
  name: io_randread_1kb_parallel_1
  config:
  - name: io_randread_1kb_parallel_1
    type: randread
    shards: all
    shard_info:
      parallelism: 1
      reqsize: 1kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_32kb_parallel_1
  config:
  - name: io_randread_32kb_parallel_1
    type: randread
    shards: all
    shard_info:
      parallelism: 1
      reqsize: 32kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_256kb_parallel_1
  config:
  - name: io_randread_256kb_parallel_1
    type: randread
    shards: all
    shard_info:
      parallelism: 1
      reqsize: 256kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_1024kb_parallel_1
  config:
  - name: io_randread_1024kb_parallel_1
    type: randread
    shards: all
    shard_info:
      parallelism: 1
      reqsize: 1024kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_1kb_parallel_20
  config:
  - name: io_randread_1kb_parallel_20
    type: randread
    shards: all
    shard_info:
      parallelism: 20
      reqsize: 1kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_32kb_parallel_20
  config:
  - name: io_randread_32kb_parallel_20
    type: randread
    shards: all
    shard_info:
      parallelism: 20
      reqsize: 32kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_256kb_parallel_20
  config:
  - name: io_randread_256kb_parallel_20
    type: randread
    shards: all
    shard_info:
      parallelism: 20
      reqsize: 256kB
      shares: 10

- type: io
  iterations: 1
  name: io_randread_1024kb_parallel_20
  config:
  - name: io_randread_1024kb_parallel_20
    type: randread
    shards: all
    shard_info:
      parallelism: 20
      reqsize: 1024kB
      shares: 10

# The following 8 tests check the impact of adding think_time and think_after to random reads 

- type: io
  iterations: 1
  name: io_randread_1kb_think_time_100
  config:
  - name: io_randread_1kb_think_time_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1kB
      shares: 10
      think_time: 100us

- type: io
  iterations: 1
  name: io_randread_32kb_think_time_100
  config:
  - name: io_randread_32kb_think_time_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 32kB
      shares: 10
      think_time: 100us

- type: io
  iterations: 1
  name: io_randread_256kb_think_time_100
  config:
  - name: io_randread_256kb_think_time_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 10
      think_time: 100us

- type: io
  iterations: 1
  name: io_randread_1024kb_think_time_100
  config:
  - name: io_randread_1024kb_think_time_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1024kB
      shares: 10
      think_time: 100us


- type: io
  iterations: 1
  name: io_randread_1kb_think_time_100_think_after_100
  config:
  - name: io_randread_1kb_think_time_100_think_after_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1kB
      shares: 10
      think_time: 100us
      think_after: 100us

- type: io
  iterations: 1
  name: io_randread_32kb_think_time_100_think_after_100
  config:
  - name: io_randread_32kb_think_time_100_think_after_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 32kB
      shares: 10
      think_time: 100us
      think_after: 100us

- type: io
  iterations: 1
  name: io_randread_256kb_think_time_100_think_after_100
  config:
  - name: io_randread_256kb_think_time_100_think_after_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 10
      think_time: 100us
      think_after: 100us

- type: io
  iterations: 1
  name: io_randread_1024kb_think_time_100_think_after_100
  config:
  - name: io_randread_1024kb_think_time_100_think_after_100
    type: randread
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 1024kB
      shares: 10
      think_time: 100us
      think_after: 100us

# The following test checks the 'cpu' option from io_tester - this is most likely not needed but we can do it anyway

- type: io
  iterations: 1
  name: io_cpu
  config:
  - name: io_cpu
    type: cpu
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 10

# The following test checks the unlinking (file deletion) speed

- type: io
  iterations: 1
  name: io_cpu
  config:
  - name: io_cpu
    type: unlink
    shards: all
    shard_info:
      parallelism: 10
      reqsize: 256kB
      shares: 10
      files_count: 5000

### RPC

# The following 12 tests check rpc with 1kB, 32kB, 256kB and 1024kB payloads, for each verb from unidirectional, bidirectional and write

- type: rpc
  name: rpc_unidirectional_1kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_unidirectional_1kb
        type: rpc
        verb: unidirectional
        parallelism: 10
        shares: 100
        payload: 1kB

- type: rpc
  name: rpc_unidirectional_32kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_unidirectional_32kb
        type: rpc
        verb: unidirectional
        parallelism: 10
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_unidirectional_256kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_unidirectional_256kb
        type: rpc
        verb: unidirectional
        parallelism: 10
        shares: 100
        payload: 256kB

- type: rpc
  name: rpc_unidirectional_1024kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_unidirectional_1024kb
        type: rpc
        verb: unidirectional
        parallelism: 10
        shares: 100
        payload: 1024kB

- type: rpc
  name: rpc_bidirectional_1kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_bidirectional_1kb
        type: rpc
        verb: bidirectional
        parallelism: 10
        shares: 100
        payload: 1kB

- type: rpc
  name: rpc_bidirectional_32kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_bidirectional_32kb
        type: rpc
        verb: bidirectional
        parallelism: 10
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_bidirectional_256kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_bidirectional_256kb
        type: rpc
        verb: bidirectional
        parallelism: 10
        shares: 100
        payload: 256kB

- type: rpc
  name: rpc_bidirectional_1024kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_bidirectional_1024kb
        type: rpc
        verb: bidirectional
        parallelism: 10
        shares: 100
        payload: 1024kB

- type: rpc
  name: rpc_write_1kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_write_1kb
        type: rpc
        verb: write
        parallelism: 10
        shares: 100
        payload: 1kB

- type: rpc
  name: rpc_write_32kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_write_32kb
        type: rpc
        verb: write
        parallelism: 10
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_write_256kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_write_256kb
        type: rpc
        verb: write
        parallelism: 10
        shares: 100
        payload: 256kB

- type: rpc
  name: rpc_write_1024kb
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_write_1024kb
        type: rpc
        verb: write
        parallelism: 10
        shares: 100
        payload: 1024kB

# The following test checks the performance of echo

- type: rpc
  name: rpc_echo
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_echo
        type: rpc
        verb: echo
        parallelism: 10
        shares: 100
        payload: 32kB

# The following 8 tests check the impact of parallelism (set to 1 or 20), for each verb from unidirectional, bidirectional, write and echo

- type: rpc
  name: rpc_unidirectional_32kb_parallel_1
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_unidirectional_32kb_parallel_1
        type: rpc
        verb: unidirectional
        parallelism: 1
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_bidirectional_32kb_parallel_1
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_bidirectional_32kb_parallel_1
        type: rpc
        verb: bidirectional
        parallelism: 1
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_write_32kb_parallel_1
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_write_32kb_parallel_1
        type: rpc
        verb: write
        parallelism: 1
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_echo_32kb_parallel_1
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_echo_32kb_parallel_1
        type: rpc
        verb: echo
        parallelism: 1
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_unidirectional_32kb_parallel_20
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_unidirectional_32kb_parallel_20
        type: rpc
        verb: unidirectional
        parallelism: 20
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_bidirectional_32kb_parallel_20
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_bidirectional_32kb_parallel_20
        type: rpc
        verb: bidirectional
        parallelism: 20
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_write_32kb_parallel_20
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_write_32kb_parallel_20
        type: rpc
        verb: write
        parallelism: 20
        shares: 100
        payload: 32kB

- type: rpc
  name: rpc_echo_32kb_parallel_20
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_echo_32kb_parallel_20
        type: rpc
        verb: echo
        parallelism: 20
        shares: 100
        payload: 32kB

# The following 4 tests check the impact of reducing the number of shares for each verb

- type: rpc
  name: rpc_unidirectional_32kb_shares_10
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_unidirectional_32kb_shares_10
        type: rpc
        verb: unidirectional
        parallelism: 10
        shares: 10
        payload: 32kB

- type: rpc
  name: rpc_bidirectional_32kb_shares_10
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_bidirectional_32kb_shares_10
        type: rpc
        verb: bidirectional
        parallelism: 10
        shares: 10
        payload: 32kB

- type: rpc
  name: rpc_write_32kb_shares_10
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_write_32kb_shares_10
        type: rpc
        verb: write
        parallelism: 10
        shares: 10
        payload: 32kB

- type: rpc
  name: rpc_echo_32kb_shares_10
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_echo_32kb_shares_10
        type: rpc
        verb: echo
        parallelism: 10
        shares: 10
        payload: 32kB

# The following 4 tests check the impact of adding sleep_time of 0.5ms for each verb

- type: rpc
  name: rpc_unidirectional_32kb_sleep_500us
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_unidirectional_32kb_sleep_500us
        type: rpc
        verb: unidirectional
        parallelism: 10
        shares: 100
        payload: 32kB
        sleep_time: 500us

- type: rpc
  name: rpc_bidirectional_32kb_sleep_500us
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_bidirectional_32kb_sleep_500us
        type: rpc
        verb: bidirectional
        parallelism: 10
        shares: 100
        payload: 32kB
        sleep_time: 500us

- type: rpc
  name: rpc_write_32kb_sleep_500us
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_write_32kb_sleep_500us
        type: rpc
        verb: write
        parallelism: 10
        shares: 100
        payload: 32kB
        sleep_time: 500us

- type: rpc
  name: rpc_echo_32kb_sleep_500us
  config:
    client:
      nodelay: true
    server:
      nodelay: true
    jobs:
      - name: rpc_echo_32kb_sleep_500us
        type: rpc
        verb: echo
        parallelism: 10
        shares: 100
        payload: 32kB
        sleep_time: 500us
